---
title: "R4DS Study Group 2 - Tibbles and Transformations"
author: "Andy Murtha"
date: '2016/05/05 (updated: `r Sys.Date()`)'
output:
  xaringan::moon_reader:
    seal: no
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: yes
      countIncrementalSlides: no
  html_document:
    df_print: paged
subtitle: Tibbles and Transformations
institute: MiR Study Group
---
class: middle, center, middle

# R4DS Study Group: Tibbles and Transformations

<br><br>.large[Andy Murtha| MiR Study Group | 09 May 2021]

<br><br>`r icons::fontawesome("github")`.large[amurtha80]
<br><br>`r icons::fontawesome("twitter")`.large[@murtha_andy]
---
class: top, center

# Tibbles

<br><br><br><br>![](TroubleWithTribbles.jpg)
---
class: top, left

# Tibbles

<br>

## What is a Tibble?

--
<br><br>

"A lazy, opinionated data frame that makes working in the tidyverse a bit easier"


<br><br><br><br><br><br>Credit: Hadley Wickam, R4DS
---
class: top, left

# Tibbles

<br>

### Attributes of a tibble

<br><br>
--
- It never changes the type of the inputs (e.g. it never converts strings to factors)
--
<br>- It never changes the names of the variables
--
<br>- It never creates row names
---
class: top, left
```{r setup, include = FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.retina = 3, 
  warning = FALSE, 
  message = FALSE,
  eval = TRUE)
library(tidyverse)
library(palmerpenguins)

hook_source <- knitr::knit_hooks$get('source')
knitr::knit_hooks$set(source = function(x, options) {
  x <- stringr::str_replace(x, "^[[:blank:]]?([^*].+?)[[:blank:]]*#<<[[:blank:]]*$", "*\\1")
  hook_source(x, options)
})
```
---
class: top, left

# Tibbles

### Creating or Converting Tibbles
.pull-left[Coercing from a data frame to a tibble
```{r}
as_tibble(iris[1:5,1:2])
```
]
--
.pull-right[Creating a tibble
```{r}
tibble(
  x = 1:5, 
  y = 1, 
  z = x ^ 2 + y
)
```
]
---

# Tibbles

### Comparing Tibbles to Data Frames

<br><br>
--
- Printing: tibbles have a refined print method that only shows the first 10 rows, and all columns fit on the screen
--
<br>- Printing: each column reports its data type, a nice feature borrowed from str()
--
<br>- Subsetting: some additional tools if you want to pull out a single variable
--
<br>- Subsetting: `$` extracts variable by name, `[[` extracts variable by name or position
--
<br>- Subsetting: To use these in a pipe you will need to use a special placeholder `.`
---

# Tibbles

### Interacting with Older Code

<br><br>
--
- Some older functions don't work with tibbles. If this is the case use `as.data.frame()` to coerce the tibble to a `data.frame`
--
<br>- The primary reason that some older functions don't work with tibble is the `[` function.
--
<br>- With base R data frames, `[` sometimes returns a data frame, and sometimes returns a vector. With tibbles, `[` always returns another tibble
---
class: top, center

# Transformations
### (with dplyr)

<br><br>
![](butterflytransformation.jpg)
---

# Transformations

### Goal: To get the data in exactly the correct form you need

--
* `dplyr::` verbs
  + `filter()` _pick observations based on their values_
  + `arrange()` _(re)order observations_
  + `select()` _choose specific variables_
  + `mutate()` _create new variables or derive variables from existing ones_
  + `summarize()` _condense many observations down to a single summary (grouped summaries)_
  + grouped `mutate()` and `filter()` _change the scope of a function from all observations in a data frame to groups of observations within a data frame_
---

# Transformations

### Poking around the `palmerpenguins` dataset

.center[![](palmerpenguins.png)]
---

# Transformations

#### `filter()` based on an observation's values

* What if we would like to view only observations related to the Adelie penguins on Dream Island (Antarctica)?

```{r filter, results='hide'}
penguins %>% 
  filter(species == "Chinstrap", island == "Dream") %>% #<<
  select(species:flipper_length_mm) %>% 
  slice_head(n = 5)
```

--

```{r ref.label='filter', echo=FALSE}
```
---

# Transformations

#### `arrange()` your observations based on a specific order of variable

* Which penguin species/island has the largest number of observations?
```{r arrange, results='hide'}
penguins %>%
  count(species, island, .drop = FALSE) %>%
  rename("count" = n) %>% 
  arrange(desc(count)) #<<
```

--

```{r ref.label='arrange', echo=FALSE}
```
---

# Transformations

#### `select()` the variables you want

- Allows one to focus on keeping specific variables for later use  

--

- `dplyr` package has many additional helper functions that allow you to get creative when selecting which variables you want to keep  

--

- This can allow you to create pipelines where you are fed source data, and through select only retain columns needed, even if the number of columns changed over time  

  - _assuming that your target variables always remained in tact_
  
---

# Transformations

#### `select()` the variables you want _cont'd_

* How would we go about grabbing only the variables with length or weight measurements?

--

```{r select-helper, results='hide'}
penguins %>%
  rowid_to_column("ID") %>% 
  select(ID, ends_with("_mm") | ends_with("_g")) %>% #<<
  slice_head(n = 5)
```

--

```{r ref.label='select-helper', echo=FALSE}
```